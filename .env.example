# Environment Configuration
# Copy this file to .env and set your actual values

# Required Security Keys (MUST be set in production)
SECRET_KEY=your-secret-key-here-change-in-production
JWT_SECRET=your-jwt-secret-here-change-in-production
# AUDIT_ENCRYPTION_KEY: REQUIRED for production/staging when audit logging is enabled
# Generate with: python -c 'from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())'
# IMPORTANT: Must be generated; example value above is invalid and will cause runtime errors
AUDIT_ENCRYPTION_KEY=

# Database Configuration
DATABASE_URL=sqlite:///./data/engineering_platform.db
# For PostgreSQL: postgresql+psycopg://user:password@localhost:5432/dbname
DB_HOST=localhost
DB_PORT=5432
DB_USER=mentor
DB_PASSWORD=mentor
DB_NAME=mentor

# Redis Configuration
# For Live Plan Mode SSE broadcasting (optional - uses in-memory if not set)
# IMPORTANT: Set REDIS_URL for production multi-server deployments
REDIS_URL=redis://localhost:6379/0
REDIS_RATE_LIMIT_TTL=3600

# Distributed Caching Configuration (PR-27)
# Enable/disable Redis-backed caching layer for hot data acceleration
CACHE_ENABLED=true                   # Enable distributed caching (default: true)
CACHE_DEFAULT_TTL_SEC=600            # Default cache TTL in seconds (10 minutes)
CACHE_MAX_VALUE_BYTES=262144         # Maximum cached value size in bytes (256 KB)

# Plan stream channel prefix
PLAN_CHANNEL_PREFIX=plan:

# Presence & Cursor Configuration (PR-22)
PRESENCE_TTL_SEC=60                  # Time before inactive user is considered offline
HEARTBEAT_SEC=20                     # Interval between heartbeat pings
PRESENCE_CLEANUP_INTERVAL_SEC=60     # How often to clean expired cache entries

# JWT Authentication Configuration (PR-23)
# Set JWT_ENABLED=true to require JWT tokens instead of DEV_* env variables
# Note: Token expiration is verified using the 'exp' claim in the JWT itself.
#       Configure expiration time (e.g., 3600 seconds = 1 hour) in your auth service.
JWT_ENABLED=false                    # Default: false (use dev shim for local development)
JWT_SECRET=your-jwt-secret-key-change-in-production-use-256-bit-key
JWT_ALGORITHM=HS256                  # Algorithm for JWT signature verification (HS256, RS256, etc.)
JWT_AUDIENCE=                        # Expected 'aud' claim (optional, e.g., api.example.com)
JWT_ISSUER=                          # Expected 'iss' claim (optional, e.g., auth.example.com)

# Auth0 Configuration (OAuth 2.0 Device Flow)
AUTH0_DOMAIN=your-auth0-domain.auth0.com           # Your Auth0 domain (safe to expose)
AUTH0_CLIENT_ID=your-auth0-client-id               # Auth0 application client ID (safe to expose)
AUTH0_CLIENT_SECRET=your-auth0-client-secret       # Auth0 client secret (KEEP SECRET!)
AUTH0_AUDIENCE=https://your-api.example.com        # Auth0 API audience identifier
AUTH0_ALGORITHM=RS256                              # JWT signature algorithm (typically RS256 for Auth0)

# VSCode Extension OAuth Device Code Flow (Development Mode)
# WARNING: Only enable these for local development! NEVER enable in production!
# When enabled, this uses an in-memory store for device codes (no Auth0 required)
OAUTH_DEVICE_USE_IN_MEMORY_STORE=false             # Set to 'true' for local dev without Auth0
OAUTH_DEVICE_AUTO_APPROVE=false                    # Set to 'true' to auto-approve after 30 seconds (dev only)

# AEP JWT Session Management
AEP_JWT_SECRET=generate-with-openssl-rand-hex-32   # Generate with: openssl rand -hex 32 (KEEP SECRET!)
AEP_JWT_ISSUER=https://your-api.example.com        # JWT issuer claim
AEP_JWT_TTL_SECONDS=3600                           # JWT expiration time in seconds (1 hour)
AEP_JWT_ALG=HS256                                  # JWT algorithm for session tokens

# Expected JWT Claims:
# - sub: user_id (required)
# - org_id: organization ID (required)
# - role: user role - viewer/planner/admin (defaults to viewer if missing)
# - email: user's email address (optional)
# - name: display name (optional)
# - projects: list of accessible project IDs (optional)

# API Configuration
API_PORT=8002
REALTIME_API_PORT=8001

# AI Configuration
OPENAI_API_KEY=your-openai-api-key-here
ANTHROPIC_API_KEY=your-anthropic-api-key-here

# Jira Integration (Step 2: NAVI Memory)
AEP_JIRA_BASE_URL=https://your-domain.atlassian.net
AEP_JIRA_EMAIL=service-account@yourcompany.com
AEP_JIRA_API_TOKEN=your_jira_api_token

# Confluence Integration (Step 2: NAVI Memory)
AEP_CONFLUENCE_BASE_URL=https://your-domain.atlassian.net/wiki
AEP_CONFLUENCE_EMAIL=service-account@yourcompany.com
AEP_CONFLUENCE_API_TOKEN=your_confluence_api_token

# Public base URL for OAuth redirects + webhook callbacks
PUBLIC_BASE_URL=https://your-public-api.example.com

# Slack OAuth
SLACK_CLIENT_ID=your-slack-client-id
SLACK_CLIENT_SECRET=your-slack-client-secret
SLACK_OAUTH_SCOPES=channels:read,groups:read,im:read,mpim:read,channels:history,groups:history,im:history,mpim:history,users:read,files:read,chat:write,chat:write.public
SLACK_USER_SCOPES=
SLACK_SIGNING_SECRET=your-slack-signing-secret

# GitHub OAuth + Webhooks
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret
GITHUB_OAUTH_SCOPES=repo read:org
GITHUB_WEBHOOK_SECRET=your-github-webhook-secret

# Confluence OAuth
CONFLUENCE_CLIENT_ID=your-confluence-client-id
CONFLUENCE_CLIENT_SECRET=your-confluence-client-secret
CONFLUENCE_OAUTH_SCOPES=read:confluence-content.all read:confluence-space.summary read:confluence-user offline_access manage:confluence-webhook

# Microsoft Teams OAuth + Webhooks
TEAMS_CLIENT_ID=your-teams-client-id
TEAMS_CLIENT_SECRET=your-teams-client-secret
TEAMS_TENANT_ID=common
TEAMS_OAUTH_SCOPES=offline_access openid profile email ChannelMessage.Read.All Group.Read.All Team.ReadBasic.All
TEAMS_WEBHOOK_SECRET=your-teams-webhook-secret

# Zoom OAuth + Webhooks
ZOOM_ACCOUNT_ID=your-zoom-account-id
ZOOM_CLIENT_ID=your-zoom-client-id
ZOOM_CLIENT_SECRET=your-zoom-client-secret
ZOOM_WEBHOOK_SECRET=your-zoom-webhook-secret

# Google OAuth (Meet/Calendar) + Webhooks
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_OAUTH_SCOPES=openid email profile offline_access https://www.googleapis.com/auth/calendar.readonly https://www.googleapis.com/auth/calendar.events.readonly https://www.googleapis.com/auth/drive.readonly
MEET_WEBHOOK_SECRET=your-google-meet-webhook-secret

# CORS Configuration
CORS_ORIGINS=http://localhost:3000,http://localhost:5173

# Application Settings
APP_ENV=dev
LOG_LEVEL=INFO
DEBUG=false
ENVIRONMENT=development

# Development Authentication Shims (Phase 1 - remove in Phase 2 with JWT/SSO)
# These env vars simulate authenticated user context for local development and CI
# In production, user context comes from JWT tokens
DEV_USER_ID=u-123
DEV_USER_EMAIL=dev@navralabs.io
DEV_USER_DISPLAY_NAME=Dev User
DEV_ORG_ID=org-1
DEV_USER_ROLE=planner  # Options: viewer, planner, admin (default: viewer)
DEV_PROJECTS=aep       # Comma-separated project IDs

# Policy File (optional - defaults to .aepolicy.json in repo root)
# POLICY_FILE=/path/to/custom/.aepolicy.json

# Observability (PR-28)
LOG_LEVEL=INFO
APP_NAME=aep

# Prometheus
PROMETHEUS_ENABLED=true

# OpenTelemetry
OTEL_ENABLED=true
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318

# Health & Resilience Configuration (PR-29)
# Health check timeouts and behavior
HEALTH_CHECK_TIMEOUT_SEC=5           # Timeout for dependency checks (DB/Redis)
HEALTH_CHECK_RETRY_COUNT=3           # Number of retries for health checks

# Circuit Breaker Settings
CIRCUIT_FAIL_THRESHOLD=5             # Number of failures before opening circuit
CIRCUIT_WINDOW_SEC=60                # Time window for counting failures
CIRCUIT_OPEN_SEC=30                  # How long to keep circuit open before half-open
CIRCUIT_SUCCESS_TO_CLOSE=2           # Consecutive successes needed to close circuit
