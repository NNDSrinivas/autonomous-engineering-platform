# Kubernetes Secret for Staging Database Credentials
#
# WARNING: This file contains placeholders. Do NOT commit actual credentials.
#
# To create the secret:
#   kubectl create secret generic navi-database-staging \
#     --from-literal=DATABASE_URL='postgresql+psycopg2://navi_staging:${STAGING_DB_PASSWORD}@staging-db-host:5432/navi_staging' \
#     --namespace navi-staging
#
# Or apply this file after replacing ${STAGING_DB_PASSWORD} with actual password:
#   kubectl apply -f database-staging.yaml
---
apiVersion: v1
kind: Secret
metadata:
  name: navi-database-staging
  namespace: navi-staging
  labels:
    app: navi
    environment: staging
type: Opaque
stringData:
  # PostgreSQL connection string
  # Format: postgresql+psycopg2://user:password@host:port/database
  #
  # Replace ${STAGING_DB_PASSWORD} with actual password before applying
  DATABASE_URL: "postgresql+psycopg2://navi_staging:${STAGING_DB_PASSWORD}@postgres-staging.navi.svc.cluster.local:5432/navi_staging"

  # Individual components (optional, for services that need them separately)
  DB_HOST: "postgres-staging.navi.svc.cluster.local"
  DB_PORT: "5432"
  DB_NAME: "navi_staging"
  DB_USER: "navi_staging"
  DB_PASSWORD: "${STAGING_DB_PASSWORD}"

  # SSL mode for PostgreSQL connection
  DB_SSLMODE: "require"
---
# ConfigMap for non-sensitive database configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: navi-database-config-staging
  namespace: navi-staging
  labels:
    app: navi
    environment: staging
data:
  # Connection pool settings
  DB_POOL_SIZE: "20"
  DB_MAX_OVERFLOW: "40"
  DB_POOL_TIMEOUT: "30"
  DB_POOL_RECYCLE: "3600"

  # Alembic migration settings
  ALEMBIC_AUTO_UPGRADE: "true"

  # Query logging (disabled in staging for performance)
  DB_ECHO: "false"
